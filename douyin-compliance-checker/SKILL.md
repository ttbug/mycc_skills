---
name: douyin-compliance-checker
description: 抖音视频发布前违规检测工具。检测视频中的图片、文字、语音是否存在违规风险，包括敏感/违禁内容、广告法违禁词、隐形限流词、引流站外行为、版权风险等。触发条件：(1) 用户说"检测抖音视频"、"视频合规检查"、"抖音违规检测" (2) 用户提供视频文件路径或抖音链接要求检测 (3) 用户说"检查视频是否违规"、"视频能不能发"
---

# 抖音视频违规检测

检测抖音视频中的图片、文字、语音内容，识别违规风险并提供修改建议。

## 前置依赖

检查并确认以下工具已安装（通过 Bash 执行 `which` 命令检查）：
- **ffmpeg/ffprobe**: 视频帧提取和音频提取
- **yt-dlp**: 从抖音链接下载视频（仅链接输入时需要）
- **whisper** (Python): 语音转文字（`pip install openai-whisper`）

缺少任何依赖时，提示用户安装命令后再继续。

## 工作流程

### Step 1: 获取视频

根据输入类型处理：

**本地文件**: 确认文件存在且为视频格式（mp4/mov/avi/mkv）。

**抖音链接**: 通过 yt-dlp 下载：
```bash
yt-dlp -o "/tmp/douyin_check/video.mp4" "<抖音链接>"
```

创建临时工作目录 `/tmp/douyin_check_<timestamp>/`。

### Step 2: 拆解素材

使用 `scripts/extract_frames.sh` 提取关键帧：
```bash
scripts/extract_frames.sh <video_path> <work_dir>/frames 3
```

使用 `scripts/extract_audio.sh` 提取音频：
```bash
scripts/extract_audio.sh <video_path> <work_dir>/audio.wav
```

使用 `scripts/transcribe_audio.py` 语音转文字：
```bash
python3 scripts/transcribe_audio.py <work_dir>/audio.wav --output <work_dir>/transcript.json
```

### Step 3: 规则匹配

读取以下词库文件，对转录文本执行关键词匹配：

1. **`references/ad_sensitive_words.md`** - 广告法敏感词（重点检测）
2. **`references/shadow_ban_words.md`** - 隐形限流词（重点检测）
3. **`references/platform_rules.md`** - 平台规则违规词（重点：引流站外）
4. **`references/prohibited_words.md`** - 违禁敏感词

匹配逻辑：
- 精确匹配词库中的关键词
- 识别谐音变体（如微信→薇信/VX/V信）
- 统计命中次数，计算累计风险

### Step 4: AI 语义分析

使用 Read 工具读取提取的关键帧图片，逐张分析：

**图片检测要点**：
- 是否含有二维码、联系方式、其他平台logo/水印
- 是否含有违禁画面（涉黄/暴力/血腥）
- 画面中的文字是否包含违禁词（OCR）
- 商品展示是否有夸大宣传文案

**文本语义分析**（结合转录文字 + 规则匹配结果）：
- 判断语境：同一词汇在不同语境下风险不同
- 识别引流话术模式（如"想要的私信我"、"详细的加我XX"）
- 检测广告合规性（功效承诺、绝对化用语）

### Step 5: 输出检测报告

在终端输出简洁报告，格式如下：

```
═══════════════════════════════════════
  抖音视频违规检测报告
═══════════════════════════════════════

视频: <文件名或链接>
时长: XX秒 | 帧数: XX | 语音: 已转录/无音频

───────────────────────────────────────
  综合风险等级: 🔴 高风险 / 🟡 中风险 / 🟢 低风险
───────────────────────────────────────

【广告违规】 🔴 高风险
  ├─ [语音 01:23] "这是最好的减肥产品" → 含极限词"最好"
  ├─ [语音 02:15] "保证一周瘦十斤" → 虚假功效承诺
  └─ 建议: 改为"很多用户反馈效果不错"等客观表达

【引流站外】 🔴 高风险
  ├─ [画面 00:45] 检测到二维码
  ├─ [语音 03:10] "加我VX" → 引流至微信
  └─ 建议: 使用抖音私信/粉丝群替代

【隐形限流】 🟡 中风险
  ├─ [语音 00:30] 提及"淘宝" → 竞品平台名
  └─ 建议: 改为"电商平台"或使用小黄车

【敏感内容】 🟢 低风险
  └─ 未检测到敏感内容

【版权风险】 🟡 中风险
  ├─ [音频] 检测到可能的热门音乐片段
  └─ 建议: 确认已获得音乐使用授权

───────────────────────────────────────
  修改建议汇总
───────────────────────────────────────
1. 删除/替换广告极限词 (2处)
2. 移除二维码画面 (1处)
3. 将引流话术改为平台内引导
4. 避免提及竞品平台名称
═══════════════════════════════════════
```

**风险等级判定**：
- 🔴 高风险：存在直接违规项（违禁内容/明确引流/广告法违规），建议修改后再发布
- 🟡 中风险：存在可能触发限流的内容，建议优化
- 🟢 低风险：未发现明显违规

## 注意事项

- 词库需持续更新，抖音规则会变化
- 检测结果仅供参考，不代表抖音官方审核结果
- 对于疑似违规但不确定的内容，标注"建议人工复核"
- 清理临时文件：检测完成后提示用户是否删除 `/tmp/douyin_check_*` 目录
